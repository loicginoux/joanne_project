<div class="row">
	<div class="span5">
		<div class="viewMode">
			<%= getPhoto(@data_point, "big")%>
		</div>
		<div class="editMode hide">
			<form id="uploadForm_<%= @data_point.id%>" action="/data_points/<%= @data_point.id%>" method="PUT" enctype="multipart/form-data">

				<div class="alert alert-block alert-error alert-delete fade in hide">
					<h4 class="alert-heading">Are you sure you want to delete?</h4>
					<p>
						<a class="btn btn-danger btn-delete" data-loading-text="Deleting..." href="javascript:void(0)">Delete</a>
						<a class="btn" href="javascript:void(0)" data-dismiss="modal">Cancel</a>
					</p>
				</div>
				<div class="editable_img_container">
					<%= getPhoto(@data_point, "big")%>
					<a class="btn btn-upload" href="javascript:void(0)">Change photo</a>
					<!-- <input class="hide data_point_photo" id="fileInput_<%= @data_point.id%>" name="data_point[photo]" type="file"> -->
					<div class="progress progress-striped active hide">
						<div class="bar" style="width: 0%;"></div>
					</div>
					<div>
						<span class="help-inline clear fileExtension">Format supported: jpg, png, gif, tiff</span>
						</br>
						<span class="help-inline clear file hide">Please upload a photo</span>
					</div>
				</div>
			</form>

			<!-- this is used when uploading the file for a datapoint
			we use a hidden iframe containing this code to be able to manipulate a file file input with javascript
			see: http://stackoverflow.com/questions/9396411/ie-javascript-form-submit-with-file-input
			other solution could have been
			https://github.com/malsup/form/issues/139#issuecomment-4881899
			 -->
			<iframe id="ifu_<%= @data_point.id%>" name="ifu" class="buttonFileHidden hide" src="/data_points/fileInputForm/<%= @data_point.id%>"></iframe>

		</div>
	</div>
	<div class="span5 info" data-id="<%= @data_point.id%>">
		<div class="editMode hide">
			<fieldset>
				<div class="control-group calories">
					<label class="control-label">Calories</label>
					<div class="controls">
						<input class="" id="data_point_calories" name="data_point[calories]" type="number"
						value="<%= @data_point.calories%>">
						<span class="help-inline calories hide">Please enter a number</span>

					</div>
				</div>

				<div class="control-group date">
					<label class="control-label">Date</label>
					<div class="controls">
						<div class="input-append date datePicker" data-date="<%= @data_point.uploaded_at.strftime("%m-%d-%Y")%>" data-date-format="mm-dd-yyyy">
							<input size="16" type="text" value="<%= @data_point.uploaded_at.strftime("%m-%d-%Y")%>">
							<span class="add-on"><i class="icon-th"></i></span>
							<span class="help-inline date hide">Please enter a correct date (mm-dd-yyy)</span>

						</div>
					</div>
				</div>
				<div class="control-group time">
					<label class="control-label">Time</label>
					<div class="controls">
						<input class="timePicker" id="timePicker_<%= @data_point.id%>" name="data_point[time]" type="text"
						value="<%= @data_point.uploaded_at.strftime("%I:%M %P")%>">
						<span class="help-inline time hide">Please enter a correct time (HH:mm)</span>
					</div>
				</div>

				<div class="control-group description">
					<div class="descrInput">
						<label class="control-label">Description (optional)</label>
						<div class="controls">
							<input class="" id="data_point_description" name="data_point[description]" type="text"
							value="<%= @data_point.description%>">
						</div>
					</div>


				</div>
			</fieldset>
		</div>
		<div class="meta viewMode">
			<% if !@data_point.description.empty? %>
			<p>Description: <%= @data_point.description%> </p>
			<%end%>
			<p>Calories: <%= @data_point.calories%> calories</p>
			<p>Date: <%= @data_point.uploaded_at.strftime("%m-%d-%Y %I:%M %P")%> </p>
			<%if @data_point.nb_likes > 0 %>
				<p>
					<i class="icon-thumbs-up"></i>
					<a href="javascript:void(0)" class="likers" rel="tooltip" title="<%= @data_point.listOfFans()%>">
						<span class="nbLikes"><%= @data_point.nb_likes%></span> <%if @data_point.nb_likes == 1 %>person<% else %>people<% end%>
					</a> <%if @data_point.nb_likes == 1 %>likes<% else %>like<% end%> this
				</p>
			<% end %>
			<%if @data_point.nb_comments > 0 %>
				<p>
					<i class="icon-comment"></i>
					<span class="nbComments"><%= @data_point.nb_comments%></span> <%if @data_point.nb_comments == 1 %>comment<% else %>comments<% end%>
				</p>
			<% end %>
		</div>
		<form>
			<div class="viewMode">
				<div class="control-group comment hide">
					<div class="controls">
						<textarea class="input-comment" placeholder="Add your comment..."></textarea>
						<span class="help-inline comment hide">Please enter a comment</span>
					</div>
				</div>


				<a href="javascript:void(0)" class="btn btn-comment viewMode" data-loading-text="Commenting...">
					<i class="icon-comment"></i> Comment
				</a>
				<%if current_user.like(@data_point).nil? %>
				<a href="javascript:void(0)" class="btn btn-like viewMode" data-action="Like">
					<i class="icon-thumbs-up"></i>
					<span> Like</span>
				</a>
				<%else%>
				<a href="javascript:void(0)" class="btn btn-like viewMode" data-action="Unlike" data-like-id="<%=current_user.like(@data_point).id%>" >
					<i class="icon-thumbs-down"></i>
					<span> Unlike</span>
				</a>
				<%end%>
				<% if @data_point.isOwner(current_user) %>
				<a href="javascript:void(0)" class="btn btn-primary btn-edit viewMode" >
					<i class="icon-white icon-pencil"></i> Edit
				</a>
				<%end%>
			</div>
			<% if @data_point.isOwner(current_user) %>
			<div class="editMode hide">
				<a href="javascript:void(0)" class="btn btn-cancel">
					Cancel
				</a>

				<a class="btn btn-danger btn-delete" data-loading-text="Deleting..." href="javascript:void(0)">
					<i class="icon-white icon-trash"></i> Delete
				</a>
				<a href="javascript:void(0)" class="btn btn-primary btn-save" data-loading-text="Saving...">
					Save changes
				</a>
			</div>
			<%end%>

		</form>
		<div class="comments">
			<%= render @data_point.comments %>
		</div>

	</div>
</div>